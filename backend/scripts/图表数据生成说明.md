# 策略图表数据生成说明

## 概述

本脚本用于为策略详情页生成图表数据，解决策略详情页中图表不显示的问题。

## 文件说明

- `add-strategy-chart-data.js` - 主要的数据插入脚本
- `run-add-chart-data.bat` - Windows 批处理运行脚本
- `run-add-chart-data.sh` - Linux/Mac shell 运行脚本

## 数据结构

### 图表类型

#### 回测策略图表
- `equity` - 净值曲线（策略净值 vs 基准）
- `drawdown` - 回撤曲线
- `returns` - 收益率分布
- `performance` - 绩效指标（夏普比率、胜率等）

#### 选股策略图表
- `stock_performance` - 个股表现
- `sector_analysis` - 行业分析
- `risk_metrics` - 风险指标
- `selection_history` - 选股历史

### 时间周期
- `1m` - 1个月
- `3m` - 3个月
- `6m` - 6个月
- `1y` - 1年

## 使用方法

### 1. 配置环境变量

确保 `.env` 文件中包含正确的数据库配置：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=stock_strategy
```

### 2. 安装依赖

```bash
npm install mysql2 dotenv
```

### 3. 运行脚本

#### Windows
```cmd
run-add-chart-data.bat
```

#### Linux/Mac
```bash
chmod +x run-add-chart-data.sh
./run-add-chart-data.sh
```

#### 或直接运行
```bash
node add-strategy-chart-data.js
```

## 数据生成规则

### 回测策略数据
1. **净值曲线**：模拟策略净值增长，包含基准对比
2. **回撤数据**：计算相对于最高点的回撤百分比
3. **收益率**：包含日收益率和累计收益率
4. **绩效指标**：夏普比率、最大回撤、胜率、盈利因子

### 选股策略数据
1. **股票表现**：模拟推荐股票的表现和评分
2. **行业分析**：各行业权重分布和收益情况
3. **风险指标**：波动率、Beta系数、VaR等
4. **选股历史**：历史选股数量、评分、成功率

## 数据特点

- 所有数据都基于合理的金融逻辑生成
- 时间序列数据按日期顺序排列
- 数据格式符合前端图表组件要求
- 支持多个时间周期的数据生成

## 注意事项

1. 运行前会清空现有的图表数据
2. 脚本会处理所有公开和已分享的策略
3. 生成的数据仅用于演示，不代表真实市场表现
4. 建议在开发/测试环境中运行

## 故障排除

### 数据库连接失败
- 检查数据库服务是否启动
- 验证 `.env` 文件中的数据库配置
- 确认数据库用户权限

### 表不存在
- 确保已运行数据库迁移脚本
- 检查 `strategy_chart_data` 表是否存在

### 数据插入失败
- 检查策略表中是否有数据
- 验证外键约束是否正确设置

## 验证结果

运行完成后可以通过以下SQL查询验证：

```sql
-- 查看总数据量
SELECT COUNT(*) FROM strategy_chart_data;

-- 按图表类型统计
SELECT chart_type, COUNT(*) as count 
FROM strategy_chart_data 
GROUP BY chart_type;

-- 按时间周期统计
SELECT period, COUNT(*) as count 
FROM strategy_chart_data 
GROUP BY period;
``` 